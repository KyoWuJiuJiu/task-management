/**
 * @file field.ts
 *
 * æœ¬æ–‡ä»¶å®šä¹‰äº†å­—æ®µç›¸å…³çš„å·¥å…·å‡½æ•°ã€‚
 *
 * âœ… `getFieldIdByName` æ˜¯ä¸€ä¸ªç”¨äºä»å­—æ®µå…ƒæ•°æ®ä¸­æŸ¥æ‰¾å­—æ®µ ID çš„å‡½æ•°ã€‚
 *
 * æˆ‘ä»¬ä¹‹å‰è®¨è®ºè¿‡ï¼š
 * - å‚æ•° `fieldMetas` çš„ç±»å‹è™½ç„¶æ˜¯ `any[]`ï¼Œä½†å®ƒè‡³å°‘æ˜ç¡®å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™æ¯”å®Œå…¨ä¸å†™ç±»å‹æ›´å¥½ã€‚
 * - ç„¶è€Œï¼Œä¸ºäº†æ›´å¼ºçš„ç±»å‹å®‰å…¨å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒï¼Œæ¨èå†™æˆç»“æ„åŒ–çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼š
 *     ```ts
 *     type FieldMeta = { id: string; name: string; type: number };
 *     ```
 * - TypeScript çš„ `strict` æ¨¡å¼å·²å¯ç”¨ï¼Œå®ƒä¼šè¦æ±‚å‚æ•°ç±»å‹æ˜¾å¼å£°æ˜ï¼Œé˜²æ­¢éšå¼ any çš„ä½¿ç”¨ã€‚
 * - æ˜¾å¼å£°æ˜ä¸º `any[]` è™½ç„¶åˆæ³•ï¼Œä¹Ÿèƒ½é€šè¿‡ strict æ£€æŸ¥ï¼Œä½†æœ¬è´¨ä¸Šç­‰äºæ”¾å¼ƒäº†ç±»å‹æ£€æŸ¥ï¼Œä¸æ¨èå¤§é‡ä½¿ç”¨ã€‚
 * - æˆ‘ä»¬åç»­å»ºè®®å°† `fieldMetas` çš„ç±»å‹ä» `any[]` ä¼˜åŒ–ä¸ºç»“æ„åŒ–çš„ `FieldMeta[]`ã€‚
 */
/**
 * @returns å­—ç¬¦ä¸²æˆ– undefinedï¼›å› ä¸ºå¯èƒ½æ‰¾ä¸åˆ°åŒ¹é…å­—æ®µ
 * æ³¨æ„ï¼šæ­¤å¤„è¿”å›çš„æ˜¯åŸºæœ¬ç±»å‹ï¼ˆstring | undefinedï¼‰ï¼Œ
 * æ‰€ä»¥ä¸èƒ½ä½¿ç”¨ interface æ¥å®šä¹‰è¿”å›ç»“æ„ã€‚
 * å¦‚æœéœ€è¦ç»™å®ƒå‘½åï¼Œåº”è¯¥ä½¿ç”¨ typeï¼Œä¾‹å¦‚ï¼š
 * type FieldId = string | undefined;
 */
export function getFieldIdByName(
  fieldMetas: any[],
  name: string,
  expectType?: number
): string | undefined {
  // æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå­—æ®µï¼Œå…¶åç§°åŒ¹é…å‚æ•° nameï¼Œä¸”ç±»å‹ï¼ˆtypeï¼‰åŒ¹é… expectTypeï¼ˆå¦‚æœæä¾›çš„è¯ï¼‰ã€‚
  // å…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š
  // - x?.name === nameï¼šä½¿ç”¨å¯é€‰é“¾å®‰å…¨è®¿é—®å­—æ®µåç§°ï¼Œé¿å…ç©ºå¯¹è±¡æŠ¥é”™
  // - expectType == nullï¼šå…è®¸ä¸ä¼ å…¥ expectTypeï¼Œæ­¤æ—¶è·³è¿‡ç±»å‹æ ¡éªŒ
  // - x?.type === expectTypeï¼šå½“ expectType è¢«æŒ‡å®šæ—¶ï¼Œè¦æ±‚å­—æ®µç±»å‹ä¸€è‡´
  // âš ï¸ æ³¨æ„ï¼šæ•´ä¸ªè¡¨è¾¾å¼çš„åˆ¤æ–­é¡ºåºéå¸¸å…³é”®ï¼Œç¡®ä¿åœ¨æ•°æ®ç¼ºå¤±æ—¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚
  // ä½¿ç”¨å¯é€‰é“¾æ“ä½œç¬¦ï¼ˆ?.ï¼‰å®‰å…¨åœ°è®¿é—®å±æ€§ï¼š
  // å¦‚æœ x ä¸º null æˆ– undefinedï¼Œx?.name ä¼šè¿”å› undefined è€Œä¸ä¼šæŠ›é”™ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨æ•°æ®ä¸å®Œæ•´æˆ–æœªåˆå§‹åŒ–æ—¶å‡ºç°è¿è¡Œæ—¶é”™è¯¯ã€‚
  // å¦‚æœæœ‰expectTypeçš„ä¼ å…¥, é‚£ä¹ˆnameå’ŒexpectTypeéƒ½è¦ç¬¦åˆ, å¦‚æœæ²¡æœ‰expectTypeçš„ä¼ å…¥, é‚£ä¹ˆåªè¦nameç¬¦åˆæ¡ä»¶å°±å¯ä»¥.
  //	â€¢	ä½¿ç”¨ Array.prototype.find() æ–¹æ³•ï¼Œåœ¨ fieldMetas æ•°ç»„ä¸­å¯»æ‰¾ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚
  //  â€¢	å¦‚æœæ‰¾åˆ°äº†è¿™ä¸ªå…ƒç´ ï¼ˆå³æŸä¸ª x ç¬¦åˆæ¡ä»¶ï¼‰ï¼Œå°±æŠŠè¿™ä¸ª x èµ‹å€¼ç»™å˜é‡ f
  //  â€¢	å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œé‚£ä¹ˆ find() è¿”å›çš„æ˜¯ undefinedï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š
  let f = fieldMetas.find(
    (x) => x?.name === name && (expectType == null || x?.type === expectType)
  );
  //   !fï¼š
  // 	â€¢	è¡¨ç¤º f æ˜¯ falsy å€¼ï¼ˆä¹Ÿå°±æ˜¯ undefined, null, false ç­‰ï¼‰
  // 	â€¢	åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒè¡¨ç¤ºï¼š
  // âœ… ã€Œå‰é¢ find() æŸ¥æ‰¾æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å­—æ®µã€

  // â¸»

  // expectType != nullï¼š
  // 	â€¢	åˆ¤æ–­ expectType æ˜¯å¦æœ‰ä¼ å…¥
  // 	â€¢	æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ éä¸¥æ ¼ç­‰äº nullï¼š
  // 	â€¢	å®ƒä¼šåŒæ—¶åˆ¤æ–­ null å’Œ undefined
  // 	â€¢	æ‰€ä»¥å¦‚æœ expectType è¢«ä¼ å…¥ï¼ˆä¸ä¸º null/undefinedï¼‰ï¼Œç»“æœä¸º true

  // å½“ name æŸ¥æ‰¾å¤±è´¥ï¼ˆå³ f === undefinedï¼‰ï¼Œå¹¶ä¸”ä¼ å…¥äº† expectTypeï¼Œå°±é€šè¿‡ ç±»å‹ å†æŸ¥ä¸€æ¬¡ã€‚
  // âœ… è¡¨ç¤ºå¦‚æœé€šè¿‡å­—æ®µåç§°æ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼ˆf æ˜¯ undefinedï¼‰ï¼Œä½†ä¼ å…¥äº†å­—æ®µç±»å‹ expectTypeï¼š
  //    - æ¯”å¦‚ expectType === 5ï¼Œè¡¨ç¤ºæŸ¥æ‰¾â€œæ—¥æœŸç±»å‹â€å­—æ®µ
  //    - å°±ä»å­—æ®µå…ƒæ•°æ®ä¸­æŸ¥æ‰¾ï¼šå­—æ®µç±»å‹æ˜¯ 5ï¼Œä¸”å­—æ®µååŒ…å«å…³é”®è¯â€œæˆªæ­¢â€æˆ–â€œæ—¥æœŸâ€çš„å­—æ®µ
  //    - ä½¿ç”¨ includes åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«å…³é”®è¯
  //    - å…³é”®è¯åŒ¹é…ä½¿ç”¨ ||ï¼Œåªè¦åç§°ä¸­åŒ…å«å…¶ä¸­ä¸€ä¸ªå³å¯
  //    - è¿™æ˜¯ä¸€ä¸ªå…œåº•ç­–ç•¥ï¼šå½“å­—æ®µå‘½åä¸æ ‡å‡†ä½†å…³é”®è¯æ˜æ˜¾æ—¶ï¼Œä»ç„¶å°è¯•è¯†åˆ«å‡ºç›®æ ‡å­—æ®µ
  // è¿™é‡Œçš„ â€˜String(x?.name || "")â€™è¡¨ç¤ºè‡³å°‘è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²æ¥å…œåº•, é¿å…åé¢çš„includesæŠ¥é”™.
  if (!f && expectType != null) {
    if (expectType === 5) {
      f = fieldMetas.find(
        (x) =>
          x?.type === 5 &&
          (String(x?.name || "").includes("æˆªæ­¢") ||
            String(x?.name || "").includes("æ—¥æœŸ"))
      );
    }
  }
  // æ˜¾å¼ returnï¼šå¦‚æœæ‰¾åˆ°å­—æ®µå¹¶åŒ…å« idï¼Œå°±è¿”å› f.idï¼Œå¦åˆ™è¿”å› undefined
  if (f && f.id) {
    return f.id;
  } else {
    return undefined;
  }
}

/**
 * ------------------------------------------
 * ğŸ’¡ TypeScript ä¸­ type å’Œ interface çš„åŒºåˆ«
 * ------------------------------------------
 *
 * âœ… interfaceï¼š
 * - ç”¨äºæè¿°â€œå¯¹è±¡ç»“æ„â€æœ€ä¸ºåˆé€‚
 * - åªèƒ½ç”¨äº `{}` åŒ…è£¹çš„å¯¹è±¡ç±»å‹
 * - æ”¯æŒç»§æ‰¿ï¼ˆextendsï¼‰ã€å£°æ˜åˆå¹¶
 * - é€‚åˆå‡½æ•°å‚æ•°ã€ç±»ã€ç»„ä»¶ propsã€API å¯¹è±¡ç­‰ç»“æ„å®šä¹‰
 *
 * âœ… typeï¼š
 * - ç”¨äºå®šä¹‰ä»»æ„ç±»å‹ï¼ˆä¸ä»…é™äºå¯¹è±¡ï¼‰
 * - å¯ä»¥å®šä¹‰åŸºæœ¬ç±»å‹åˆ«åï¼Œå¦‚ `type ID = string`
 * - å¯ä»¥è¡¨ç¤ºè”åˆç±»å‹ã€äº¤å‰ç±»å‹ï¼Œä¾‹å¦‚ `string | number`
 * - æ›´é€‚åˆæè¿°å¤æ‚ç±»å‹ç»„åˆã€è”åˆã€å·¥å…·ç±»å‹ç­‰
 *
 * ğŸ“Œ æ€»ç»“é€‰æ‹©å»ºè®®ï¼š
 * - å¦‚æœæ˜¯çº¯å¯¹è±¡ç»“æ„ï¼Œä¼˜å…ˆç”¨ interfaceï¼ˆå¦‚ FieldMetaï¼‰
 * - å¦‚æœæ˜¯å­—ç¬¦ä¸²ã€è”åˆç±»å‹ã€æˆ–éå¯¹è±¡ç»“æ„ï¼Œç”¨ typeï¼ˆå¦‚ string | undefinedï¼‰
 */
